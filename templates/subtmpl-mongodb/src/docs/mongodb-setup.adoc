= MongoDB setup

== Cleaning previously started container

[source,shell]
----
docker ps -a
docker kill ${mongoDockerContainerName}; docker rm ${mongoDockerContainerName}
----

== Cleaning data

[source,shell]
----
rm -rf /data/mongodb
----

== Start mongo

[source,shell]
----
docker pull mongo:3.4.1
docker run --name ${mongoDockerContainerName} -v /data/mongodb:/data/db -d mongo:3.4.1 --auth
----

== Add admin user

[source,shell]
----
docker exec -it ${mongoDockerContainerName} mongo admin
----

[source,shell]
.Execute in mongo shell
----
db.createUser({ user: '${adminUsername}', pwd: '?PASSWORD', roles: [ { role: "userAdminAnyDatabase", db: "${mongoAuthDatabase}" } ] });
----

== Add root user

[source,shell]
----
docker run -it --rm --link ${mongoDockerContainerName}:mongo mongo:3.4.1 mongo -u ${adminUsername} -p ?PASSWORD --authenticationDatabase ${mongoAuthDatabase} ${mongoDockerContainerName}/${mongoAuthDatabase}
----

[source,shell]
.Execute in mongo shell
----
db.createUser({ user: '${rootUsername}', pwd: '?PASSWORD', roles: [ { role: "root", db: "${mongoAuthDatabase}" } ] });
----

== Add service user

[source,shell]
----
docker run -it --rm --link ${mongoDockerContainerName}:mongo mongo:3.4.1 mongo -u ${adminUsername} -p ?PASSWORD --authenticationDatabase ${mongoAuthDatabase} ${mongoDockerContainerName}/${mongoAuthDatabase}
----

[source,shell]
.Execute in mongo shell
----
db.createUser({ user: '${serviceUsername}', pwd: '?PASSWORD', roles: [ { role: "readWriteAnyDatabase", db: "${mongoAuthDatabase}" } ] });
----

== Connect externally

[source,shell]
----
docker run -it --rm --link ${mongoDockerContainerName}:mongo mongo:3.4.1 mongo -u ${adminUsername} -p ?PASSWORD --authenticationDatabase ${mongoAuthDatabase} ${mongoDockerContainerName}/${mongoAuthDatabase}
----

[source,shell]
----
docker run -it --rm --link ${mongoDockerContainerName}:mongo mongo:3.4.1 mongo -u ${serviceUsername} -p ?PASSWORD --authenticationDatabase ${mongoAuthDatabase} ${mongoDockerContainerName}/${mongoDatabase}
----
